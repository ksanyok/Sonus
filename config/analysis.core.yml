# Core Analysis Configuration
# All key parameters for call audit prototype

transcription:
  model: gpt-4o-mini-transcribe
  response_format: verbose_json
  language_hint: auto  # ru|uk|auto
  max_duration_sec: 5400

segmentation:
  min_silence_ms: 400
  speaker_change_on_overlap: true

audio_metrics:
  enable: true
  lufs_target: -23.0
  rms_window_sec: 0.5
  db_spike_threshold_db: 9.0
  db_spike_min_duration_ms: 300
  overlap_window_ms: 250
  speech_ratio_min_sample_sec: 10

conversation_type:
  enable: true
  rules:
    ptp_keywords: ["обіцяю", "обещаю", "внесу", "плачу до", "сплачу до"]
    refusal_keywords: ["не буду", "відмовляюся", "не собираюсь", "никак"]
    third_party_keywords: ["я не клиент", "это не я", "третье лицо", "3-я особа"]
  min_confidence: 0.5

lexicon_triggers:
  enable: true
  normalize:
    lower: true
    collapse_spaces: true
    strip_punct: true
    deobfuscate: true
  categories:
    profanity:
      files: ["config/lexicon/profanity.ru.txt", "config/lexicon/profanity.uk.txt"]
    regulator:
      files: ["config/lexicon/regulator.txt"]
    you_informal:
      files: ["config/lexicon/you_informal.txt"]
    complaint:
      inline: ["скарга", "жалоба", "нарікання"]
  time_snap_to_segment: true

emotion_tone:
  enable: true
  labels: ["calm", "neutral", "tense", "angry", "empathic", "sad", "excited"]
  granularity: "segment"
  db_spike_as_evidence: true

scoring:
  mandatory:
    - { id: greeting, title: "Привітання", max: 5 }
    - { id: ident, title: "Ідентифікація клієнта", max: 5 }
    - { id: demand, title: "Вимога погашення заборгованості", max: 5 }
  general:
    - { id: focus, title: "Концентрація на ситуації клієнта", max: 4 }
    - { id: motivation, title: "Мотивація на оплату", max: 5 }
    - { id: objections, title: "Відпрацювання заперечень", max: 5 }
    - { id: language_emotion, title: "Грамотність мови/емоційний стан", max: 5 }
    - { id: wrapup, title: "Підведення підсумків", max: 5 }
  ethics:
    - { id: threats_abuse, title: "Погрози/грубість/шантаж", fatal: true }
    - { id: mislead, title: "Введення в оману", fatal: true }
    - { id: bank_secret, title: "Розголошення банківської таємниці", fatal: true }
    - { id: no_consent, title: "Не взято згоду", fatal: true }
    - { id: full_amount, title: "Вимога оплати до повного погашення", fatal: false }
  evidence:
    quote_max_chars: 180
    attach_timestamps: true
  final_score_formula: "avg(mandatory)+avg(general)"
  ethics_penalties:
    fatal_flag_sets_ethics_flag: true
    non_fatal_deduction: 1.0
    clamp_min: 0.0

recommendations:
  enable: true
  embeddings_model: text-embedding-3-large
  top_k: 3
  by_low_score_threshold: 0.6
  include_examples: true

exports:
  xlsx:
    sheet_scores: "Оценка"
    sheet_triggers: "Триггеры"
    sheet_reco: "Рекомендации"
    columns_scores: ["Блок", "Критерий", "Макс", "Факт", "Цитата", "Таймкод", "Комментарий"]
  csv:
    delimiter: ","

webhook:
  enable: true
  retry:
    attempts: 3
    backoff_sec: 5

diagnostics:
  show_confidence: true
  show_lufs: true
  show_agent_talk_ratio: true
  show_overlap_ratio: true
  show_latency_stats: true
