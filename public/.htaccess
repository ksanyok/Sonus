<IfModule mod_rewrite.c>
    RewriteEngine On

    # Deny access to install.php if .env exists (security)
    RewriteCond %{REQUEST_URI} install\.php$
    RewriteCond %{DOCUMENT_ROOT}/../.env -f
    RewriteRule ^install\.php$ - [F,L]

    # Auto-redirect to installer if .env doesn't exist
    RewriteCond %{REQUEST_URI} !install\.php$
    RewriteCond %{REQUEST_URI} !healthz$
    RewriteCond %{DOCUMENT_ROOT}/../.env !-f
    RewriteRule ^(.*)$ install.php [L]

    # Redirect to front controller
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [QSA,L]
</IfModule>
