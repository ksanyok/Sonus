{% extends "layouts/base.twig" %}

{% block title %}–ê–Ω–∞–ª–∏–∑ –∑–≤–æ–Ω–∫–æ–≤ - Call Audit Proto{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto" x-data="uploadForm()">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">üìû –ê–Ω–∞–ª–∏–∑ –∑–≤–æ–Ω–∫–∞</h2>
            <p class="text-gray-600">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</p>
        </div>

        <form method="POST" action="/jobs" enctype="multipart/form-data" @submit="handleSubmit">
            <!-- Audio File -->
            <div class="mb-8">
                <label for="audio" class="block text-base font-semibold text-gray-700 mb-3">
                    –ê—É–¥–∏–æ—Ñ–∞–π–ª
                </label>
                <div class="relative">
                    <input 
                        type="file" 
                        id="audio" 
                        name="audio" 
                        accept=".mp3,.wav"
                        required
                        class="block w-full text-sm text-gray-900 border-2 border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 p-3 hover:border-blue-400 transition"
                        @change="audioFile = $event.target.files[0]?.name"
                    >
                </div>
                <p class="mt-2 text-sm text-gray-500">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: MP3, WAV (–¥–æ 50MB)</p>
                <p class="mt-2 text-sm font-medium text-blue-600" x-show="audioFile" x-text="'‚úì –í—ã–±—Ä–∞–Ω: ' + audioFile"></p>
            </div>

            <!-- Hidden fields -->
            <input type="hidden" name="lang" value="auto">

            <!-- Submit Button -->
            <div class="mt-8">
                <button 
                    type="submit" 
                    :disabled="submitting || !audioFile"
                    class="w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white text-lg font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg"
                >
                    <span x-show="!submitting">üöÄ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span>
                    <span x-show="submitting" x-cloak class="flex items-center justify-center">
                        <svg class="animate-spin h-6 w-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>–û–±—Ä–∞–±–æ—Ç–∫–∞... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</span>
                    </span>
                </button>
            </div>
        </form>

        <!-- Loading Overlay -->
        <div x-show="submitting" x-cloak class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg p-8 max-w-md mx-4 text-center">
                <svg class="animate-spin h-16 w-16 mx-auto mb-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <h3 class="text-xl font-bold text-gray-900 mb-2">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤–æ–Ω–æ–∫...</h3>
                <p class="text-gray-600 mb-4">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç</p>
                <div class="space-y-2 text-sm text-gray-500 text-left">
                    <div class="flex items-center">
                        <span class="inline-block w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse"></span>
                        –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ–º –∞—É–¥–∏–æ
                    </div>
                    <div class="flex items-center">
                        <span class="inline-block w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse delay-75"></span>
                        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ—Ç—Ä–∏–∫–∏
                    </div>
                    <div class="flex items-center">
                        <span class="inline-block w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse delay-150"></span>
                        –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã
                    </div>
                    <div class="flex items-center">
                        <span class="inline-block w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse delay-300"></span>
                        –û—Ü–µ–Ω–∏–≤–∞–µ–º –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info -->
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="text-sm font-semibold text-blue-900 mb-2">‚ÑπÔ∏è –ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:</h3>
        <ul class="text-sm text-blue-800 space-y-1">
            <li>‚Ä¢ –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∏ —Ç–∞–π–º–∫–æ–¥—ã</li>
            <li>‚Ä¢ –û—Ü–µ–Ω–∫–∞ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –∫–∞—á–µ—Å—Ç–≤–∞</li>
            <li>‚Ä¢ –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è</li>
            <li>‚Ä¢ –ê—É–¥–∏–æ-–º–µ—Ç—Ä–∏–∫–∏ –∏ —ç–º–æ—Ü–∏–∏</li>
        </ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function uploadForm() {
    return {
        audioFile: '',
        submitting: false,
        handleSubmit(e) {
            if (!this.audioFile) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª');
                return;
            }
            this.submitting = true;
            console.log('Starting analysis for:', this.audioFile);
        }
    }
}
</script>
{% endblock %}
